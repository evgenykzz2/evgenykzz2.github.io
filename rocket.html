<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Rocket Calculator</title>
    <style>
        body {
            margin: 0;
            padding: 0;
			background-color: #FFFFFF;
			background-image: url(https://i.pinimg.com/originals/32/da/70/32da70fa743ed140848005d13d0b83ff.jpg);
			background-position: top;
			background-repeat: repeat;
			background-attachment: fixed;
			font-family: "Verdana", sans-serif;
			font-size: 1.2em;
			text-align: center;
        }
        html, body {
            min-height: 100%;
            height: 100%;
        }
        .content {
            margin: 0 10px;
			background-color: #ffffff;
			display: inline-block;
			text-align: left;
			max-width:1800px;
        }
		input{width:64px; font-size: 1.1em;}
		input[type=range]{width:96px;}
		select{font-size: 1.1em;}
        .info {
            background-color: gainsboro;
            padding: 15px;
			position: fixed;
			bottom: 0;
			right: 0;
        }
		table {
			border-collapse: collapse;
		}
        ul {
            margin: 0;
        }
		.preview {
			background-color: black;
			color: #fff;
			text-align: center;
			padding: 5px 5px;
			border-radius: 6px;
 			position: fixed;
		}
	}
    </style>
</head>
<body>

<div class="content">
<p align=center><font size="32">Rocket Calculator</font></p>

<table border="0">
<td valign="top" width=750 max-width=750>

	<table border="0">
	<tr>
	<td>
	<font size="6">Rocket<br></font>
	<select id="Rocket"></select> <font size="2"><label id="RocketDescription"></label></font>
	
	<table border="1">
	<tr><td width=460>Fuel</td></td><td width=220> <select id="Fuel"></select> </td></tr>
	<tr><td>Stages</td><td> <label id="Stages"></label></td></tr>
	<tr><td>Thrust-to-weight ratio</td><td> <input id="Thrust_to_weight_ratio"></td></tr>
	<tr><td>Lift-off Mass</td><td> <input id="Lift_off_Mass">Kg</td></tr>
	<tr><td>Fairing mass</td><td> <input id="Fairing_mass">Kg</td></tr>
	<tr><td>Fairing jettison velocity</td><td> <input id="Fairing_jettison_velocity">m/s</td></tr>
	<tr class="Expanding"><td>Fairing jettison specific velocity</td><td> <label id="Fairing_jettison_specific_velocity"></label>m/s</td></tr>
	<tr><td>Jettisoned battery mass</td><td> <input id="Jettisoned_battery_mass" value="0">Kg</td></tr>

	<tr><td>Assumed payload mass</td><td> <input id="Assumed_payload_mass" value="750">Kg</td></tr>
	
	<tr><td>Payload to Lift-off mass Ratio</td><td> <label id="Payload_to_Lift_off_mass_Ratio"></label>%</td></tr>
	
	<tr><td>2nd Stage to Lift-off mass Ratio</td><td> <input id="_2nd_Stage_mass_Ratio">%</td></tr>
	<tr><td>Transfer Orbit Stage to Lift-off mass Ratio</td><td> <input id="_3rd_Stage_mass_Ratio">%</td></tr>
	
	
	<tr><td>1st Dry to Wet mass Ratio</td><td> <input type="range" min="1" max="100" value="50" class="slider" id="_1st_Dry_to_Wet_mass_Ratio_Range">
											   <input id="_1st_Dry_to_Wet_mass_Ratio">%</td></tr>

	<tr><td>2nd Dry to Wet mass Ratio</td><td> <input type="range" min="1" max="100" value="50" class="slider" id="_2nd_Dry_to_Wet_mass_Ratio_Range">
											   <input id="_2nd_Dry_to_Wet_mass_Ratio">%</td></tr>

	<tr><td>Transfer Orbit Stage Dry to Wet mass Ratio</td><td> <input type="range" min="1" max="100" value="50" class="slider" id="Transfer_Orbit_Stage_mass_Ratio_Range">
											   <input id="Transfer_Orbit_Stage_mass_Ratio">%</td></tr>

	<tr><td>Unused propellant of 1st Stage</td><td> <input type="range" min="1" max="100" value="50" class="slider" id="Unused_propellant_of_1st_Stage_Range">
											   <input id="Unused_propellant_of_1st_Stage">%</td></tr>

	<tr><td>Unused propellant of 2nd Stage</td><td> <input type="range" min="1" max="100" value="50" class="slider" id="Unused_propellant_of_2nd_Stage_Range">
											   <input id="Unused_propellant_of_2nd_Stage">%</td></tr>

	<tr class="3Stage"><td>Unused propellant of Transfer Orbit Stage</td><td> <input type="range" min="1" max="100" value="50" class="slider" id="Unused_propellant_of_Transfer_Orbit_Stage_Range">
											   <input id="Unused_propellant_of_Transfer_Orbit_Stage">%</td></tr>

	<tr><td>First stage isp sea level or at the start altitude</td><td> <input type="range" min="1" max="100" value="50" class="slider" id="First_stage_isp_sea_level_or_at_the_start_altitude_Range">
											   <input id="First_stage_isp_sea_level_or_at_the_start_altitude">s</td></tr>

	<tr><td>First stage isp vac</td><td> <input type="range" min="1" max="100" value="50" class="slider" id="First_stage_isp_vac_Range">
											   <input id="First_stage_isp_vac">s</td></tr>

	<tr><td>Second stage isp vac</td><td> <input type="range" min="1" max="100" value="50" class="slider" id="Second_stage_isp_vac_Range">
											   <input id="Second_stage_isp_vac">s</td></tr>

	<tr class="3Stage"><td>Transfer Orbit Stage isp</td><td> <input type="range" min="1" max="100" value="50" class="slider" id="Transfer_Orbit_Stage_isp_Range">
											   <input id="Transfer_Orbit_Stage_isp">s</td></tr>
	
	<tr><td>Specific Impulse Variation</td><td> <input id="Specific_Impulse_Variation" value=100>%</td></tr>
	
											   

	</table>
	</td>
	</tr>
	
	
	<tr>
	<td>
	<font size="6">Result<br></font>
	<table border="1">
	<tr class="Expanding"><td>Payload mass (1)</td><td> <label id="Payload_mass_calculated"></label>Kg</td></tr>
	<tr><td width=460>Payload mass (calculated)</td><td width=220> <label id="Payload_mass_calculated5"></label>Kg</td></tr>
	<tr><td>Payload change</td><td> <label id="Payload_change"    ></label>%</td></tr>
	<tr><td>Expand</td><td><input type="checkbox" id="Expand"></td></tr>
	</table>
	</td>
	</tr>
	</table>
</td>

<td valign="top">

	<table border="0">
	<tr>
	<td>
	<font size="6">Spaceport<br></font>
	<select id="StartingPoint"> </select>Air Launch<input type="checkbox" id="Air_Launch">

	<table border="1">
	<tr><td width=460>Starting Point Altitude</td><td width=220> <input id="Starting_Point_Altitude">Km</td></tr>
	<tr><td>Additional Speed</td><td> <input id="Additional_Speed"              value=0>m/s</td></tr>
	<tr><td>Spaceport latitude</td><td> <input id="Spaceport_latitude"          >deg</td></tr>
	
	<tr class="Expanding"><td>Intermediate angle</td><td> <label id="Intermediate_angle"    ></labeldeg></td></tr>
	<tr><td>Launch azimuth</td><td> <label id="Launch_azimuth"            ></label>deg</td></tr>
	<tr><td>Launch point speed</td><td> <label id="Launch_point_speed"    ></label>m/s</td></tr>
	<tr class="Expanding"><td>Starting Point Altitude orbital velosity</td><td> <label id="Starting_Point_Altitude_orbital_velosity"    ></label>m/s</td></tr>
	<tr class="Expanding"><td>Absolute orbital velocity</td><td> <label id="Absolute_orbital_velocity"    ></label>m/s</td></tr>
	<tr class="Expanding"><td>Relative orbital velocity</td><td> <label id="Orbital_velocity"    ></label>m/s</td></tr>
	<tr class="Expanding"><td>Orbital velocity increment due to the Earth rotation</td><td> <label id="Orbital_velocity_increment_due_to_the_Earth_rotation"    ></label>m/s</td></tr>
	<tr class="Expanding"><td>Specific velocity for circular orbit</td><td> <label id="Specific_velocity_for_circular_orbit"    ></label>m/s</td></tr>
	<tr class="Expanding"><td>Specific velocity for LEO</td><td> <label id="Specific_velocity_for_LEO"    ></label>m/s</td></tr>
	</table>
	</tr>
	</td>
	
	<tr>
	<td>
	<font size="6">Orbit<br></font>
	<select id="Orbit">
	</select>
	<table border="1">
	<tr><td width=460>Orbital period</td><td width=220> <label id="Orbital_period"    ></label>min</td></tr>
	<tr><td>Orbit Perigee</td><td> <input id="Orbit_Perigee"                    value=200>Km</td></tr>
	<tr><td>Orbit Apogee</td><td> <input id="Orbit_Apogee"                      value=0>Km</td></tr>
	<tr><td>Orbit Inclination</td><td> <input id="Orbit_Inclination"            value=28.5>deg</td></tr>
	<tr><td>Specific velocity for target orbit</td><td> <label id="Specific_velocity_for_target_orbit"    ></label>m/s</td></tr>
	<tr><td>Extra speed for flight to the planets</td><td> <input id="Extra_speed_for_flight_to_the_planets"            value=0.0>m/s</td></tr>
	</table>	
	</td>
	</tr>

	<tr>
	<td>
	<font size="6">Losses<br></font>
	<table border="1">
	<tr class="Expanding"><td>Gravity losses at specific altitude</td><td> <label id="Gravity_losses_at_specific_altitude"    ></label>m/s</td></tr>
	<tr class="Expanding"><td>Gravity losses</td><td> <label id="Gravity_losses"            ></label>m/s</td></tr>
	<tr><td width=460>Aerodynamic losses</td><td width=220> <label id="Aerodynamic_losses"    ></label>m/s</td></tr>
	<tr><td>Summary losses</td><td> <label id="Summary_losses"    ></label>m/s</td></tr>
	<tr><td>Assumed losses</td><td> <label id="Assumed_losses"    ></label>%</td></tr>
	<tr><td>Specific velocity with losses</td><td> <label id="Specific_velocity_with_losses"    ></label>m/s</td></tr>
	</table>
	</td>
	</tr>

	<tr>
	<td>
	<font size="6">Output<br></font>
	<table border="1">
	<tr class="Expanding"><td>First stage average trajectory isp</td><td> <label id="First_stage_average_trajectory_isp"></label>s</td></tr>
	<tr><td width=460>First stage specific velocity</td><td width=220 max-width=220> <label id="First_stage_specific_velocity"></label>m/s</td></tr>
	<tr class="Expanding"><td>First stage final mass</td><td> <label id="First_stage_final_mass"></label>Kg</td></tr>
	<tr class="Expanding"><td>First stage propellant mass</td><td> <label id="First_stage_propellant_mass"></label>Kg</td></tr>
	<tr class="Expanding"><td>First stage dry mass</td><td> <label id="First_stage_dry_mass"></label>Kg</td></tr>
	
	<tr><td>Second stage specific velocity</td><td> <label id="Second_stage_specific_velocity"    ></label>m/s</td></tr>
	<tr class="Expanding"><td>Second stage total (Start) mass</td><td> <label id="Second_stage_total_Start_mass"    ></label>Kg</td></tr>
	<tr class="Expanding"><td>Second stage total mass before fairing jettison</td><td> <label id="Second_stage_total_mass_before_fairing_jettison"    ></label>Kg</td></tr>
	<tr class="Expanding"><td>Second stage total mass before battery jettison</td><td> <label id="Second_stage_total_mass_before_battery_jettison"    ></label>Kg</td></tr>
	<tr class="Expanding"><td>Second stage specific velocity before battery jettison</td><td> <label id="Second_stage_specific_velocity_before_battery_jettison"    ></label>Kg</td></tr>
	
	<tr class="Expanding"><td>Second stage final mass</td><td> <label id="Second_stage_final_mass"    ></label>Kg</td></tr>
	<tr class="Expanding"><td>Second stage propellant mass</td><td> <label id="Second_stage_propellant_mass"    ></label>Kg</td></tr>
	<tr class="Expanding"><td>Second stage dry mass</td><td> <label id="Second_stage_dry_mass"    ></label>Kg</td></tr>
	
	<tr><td>Transfer Orbit stage specific velocity (required)</td><td> <label id="Transfer_Orbit_stage_specific_velocity_required"    ></label>m/s</td></tr>
	<tr class="Expanding"><td>Transfer Orbit stage total (Start) mass</td><td> <label id="Transfer_Orbit_stage_total_Start_mass"    ></label>Kg</td></tr>
	<tr class="Expanding"><td>Transfer Orbit stage final mass</td><td> <label id="Transfer_Orbit_stage_final_mass"    ></label>Kg</td></tr>
	<tr class="Expanding"><td>Transfer Orbit stage propellant mass</td><td> <label id="Transfer_Orbit_stage_propellant_mass"    ></label>Kg</td></tr>
	<tr class="Expanding"><td>Transfer Orbit stage dry mass</td><td> <label id="Transfer_Orbit_stage_dry_mass"    ></label>Kg</td></tr>
	</table>
	</td>
	</tr>
	</table>
</td>
</table>
</div>

<script>
	var elStartingPoint = document.querySelector('#StartingPoint');
	
	var elAir_Launch = document.querySelector('#Air_Launch');
	var elStarting_Point_Altitude = document.querySelector('#Starting_Point_Altitude');
	var elAdditional_Speed = document.querySelector('#Additional_Speed');
	var elOrbit_Perigee = document.querySelector('#Orbit_Perigee');
	var elOrbit_Apogee = document.querySelector('#Orbit_Apogee');
	var elSpaceport_latitude = document.querySelector('#Spaceport_latitude');
	var elOrbit_Inclination = document.querySelector('#Orbit_Inclination');

	var elIntermediate_angle = document.querySelector('#Intermediate_angle');
	var elLaunch_azimuth = document.querySelector('#Launch_azimuth');
	var elLaunch_point_speed = document.querySelector('#Launch_point_speed');
	var elStarting_Point_Altitude_orbital_velosity = document.querySelector('#Starting_Point_Altitude_orbital_velosity');
	var elAbsolute_orbital_velocity = document.querySelector('#Absolute_orbital_velocity');
	var elOrbital_period = document.querySelector('#Orbital_period');
	var elOrbital_velocity = document.querySelector('#Orbital_velocity');
	var elOrbital_velocity_increment_due_to_the_Earth_rotation = document.querySelector('#Orbital_velocity_increment_due_to_the_Earth_rotation');
	var elSpecific_velocity_for_circular_orbit = document.querySelector('#Specific_velocity_for_circular_orbit');
	var elSpecific_velocity_for_target_orbit = document.querySelector('#Specific_velocity_for_target_orbit');
	var elSpecific_velocity_for_LEO = document.querySelector('#Specific_velocity_for_LEO');

	var elOrbit = document.querySelector('#Orbit');

	//=== ROCKET ===
	var elRocket = document.querySelector('#Rocket');
	var elRocketDescription = document.querySelector('#RocketDescription');
	var elThrust_to_weight_ratio = document.querySelector('#Thrust_to_weight_ratio');
	
	var elStages = document.querySelector('#Stages');
	var elLift_off_Mass = document.querySelector('#Lift_off_Mass');
	var elFairing_mass = document.querySelector('#Fairing_mass');
	var elFairing_jettison_velocity = document.querySelector('#Fairing_jettison_velocity');
	var elFairing_jettison_specific_velocity = document.querySelector('#Fairing_jettison_specific_velocity');
	var elJettisoned_battery_mass = document.querySelector('#Jettisoned_battery_mass');
	
	var elAssumed_payload_mass = document.querySelector('#Assumed_payload_mass');
	var elPayload_to_Lift_off_mass_Ratio = document.querySelector('#Payload_to_Lift_off_mass_Ratio');
	var el2nd_Stage_mass_Ratio = document.querySelector('#_2nd_Stage_mass_Ratio');
	var el3rd_Stage_mass_Ratio = document.querySelector('#_3rd_Stage_mass_Ratio');
	var el1st_Dry_to_Wet_mass_Ratio_Range = document.querySelector('#_1st_Dry_to_Wet_mass_Ratio_Range');
	var el1st_Dry_to_Wet_mass_Ratio = document.querySelector('#_1st_Dry_to_Wet_mass_Ratio');
	var el2nd_Dry_to_Wet_mass_Ratio_Range = document.querySelector('#_2nd_Dry_to_Wet_mass_Ratio_Range');
	var el2nd_Dry_to_Wet_mass_Ratio = document.querySelector('#_2nd_Dry_to_Wet_mass_Ratio');
	var elTransfer_Orbit_Stage_mass_Ratio_Range = document.querySelector('#Transfer_Orbit_Stage_mass_Ratio_Range');
	var elTransfer_Orbit_Stage_mass_Ratio = document.querySelector('#Transfer_Orbit_Stage_mass_Ratio');
	var elUnused_propellant_of_1st_Stage_Range = document.querySelector('#Unused_propellant_of_1st_Stage_Range');
	var elUnused_propellant_of_1st_Stage = document.querySelector('#Unused_propellant_of_1st_Stage');
	var elUnused_propellant_of_2nd_Stage_Range = document.querySelector('#Unused_propellant_of_2nd_Stage_Range');
	var elUnused_propellant_of_2nd_Stage = document.querySelector('#Unused_propellant_of_2nd_Stage');
	var elUnused_propellant_of_Transfer_Orbit_Stage_Range = document.querySelector('#Unused_propellant_of_Transfer_Orbit_Stage_Range');
	var elUnused_propellant_of_Transfer_Orbit_Stage = document.querySelector('#Unused_propellant_of_Transfer_Orbit_Stage');
	var elFirst_stage_isp_sea_level_or_at_the_start_altitude_Range = document.querySelector('#First_stage_isp_sea_level_or_at_the_start_altitude_Range');
	var elFirst_stage_isp_sea_level_or_at_the_start_altitude = document.querySelector('#First_stage_isp_sea_level_or_at_the_start_altitude');
	var elFirst_stage_isp_vac_Range = document.querySelector('#First_stage_isp_vac_Range');
	var elFirst_stage_isp_vac = document.querySelector('#First_stage_isp_vac');
	var elSecond_stage_isp_vac_Range= document.querySelector('#Second_stage_isp_vac_Range');
	var elSecond_stage_isp_vac = document.querySelector('#Second_stage_isp_vac');
	var elTransfer_Orbit_Stage_isp_Range = document.querySelector('#Transfer_Orbit_Stage_isp_Range');
	var elTransfer_Orbit_Stage_isp = document.querySelector('#Transfer_Orbit_Stage_isp');
	var elExtra_speed_for_flight_to_the_planets = document.querySelector('#Extra_speed_for_flight_to_the_planets');
	var elSpecific_Impulse_Variation = document.querySelector('#Specific_Impulse_Variation');

	var elFuel = document.querySelector('#Fuel');
	
	//=== Loses ===
	var elGravity_losses_at_specific_altitude = document.querySelector('#Gravity_losses_at_specific_altitude');
	var elGravity_losses = document.querySelector('#Gravity_losses');
	var elAerodynamic_losses = document.querySelector('#Aerodynamic_losses');
	var elSummary_losses = document.querySelector('#Summary_losses');
	var elAssumed_losses = document.querySelector('#Assumed_losses');
	var elSpecific_velocity_with_losses = document.querySelector('#Specific_velocity_with_losses');
	
	//=== Output ===
	var elFirst_stage_average_trajectory_isp = document.querySelector('#First_stage_average_trajectory_isp');
	var elFirst_stage_specific_velocity = document.querySelector('#First_stage_specific_velocity');
	var elFirst_stage_final_mass = document.querySelector('#First_stage_final_mass');
	var elFirst_stage_propellant_mass = document.querySelector('#First_stage_propellant_mass');
	var elFirst_stage_dry_mass = document.querySelector('#First_stage_dry_mass');

	var elSecond_stage_specific_velocity = document.querySelector('#Second_stage_specific_velocity');
	var elSecond_stage_total_Start_mass = document.querySelector('#Second_stage_total_Start_mass');
	var elSecond_stage_total_mass_before_fairing_jettison = document.querySelector('#Second_stage_total_mass_before_fairing_jettison');
	var elSecond_stage_total_mass_before_battery_jettison = document.querySelector('#Second_stage_total_mass_before_battery_jettison');
	var elSecond_stage_specific_velocity_before_battery_jettison = document.querySelector('#Second_stage_specific_velocity_before_battery_jettison');
	
	var elSecond_stage_final_mass = document.querySelector('#Second_stage_final_mass');
	var elSecond_stage_propellant_mass = document.querySelector('#Second_stage_propellant_mass');
	var elSecond_stage_dry_mass = document.querySelector('#Second_stage_dry_mass');
	
	var elTransfer_Orbit_stage_specific_velocity_required = document.querySelector('#Transfer_Orbit_stage_specific_velocity_required');
	var elTransfer_Orbit_stage_total_Start_mass = document.querySelector('#Transfer_Orbit_stage_total_Start_mass');
	var elTransfer_Orbit_stage_final_mass = document.querySelector('#Transfer_Orbit_stage_final_mass');
	var elTransfer_Orbit_stage_propellant_mass = document.querySelector('#Transfer_Orbit_stage_propellant_mass');
	var elTransfer_Orbit_stage_dry_mass = document.querySelector('#Transfer_Orbit_stage_dry_mass');

	var elPayload_mass_calculated  = document.querySelector('#Payload_mass_calculated');
	var elPayload_mass_calculated5 = document.querySelector('#Payload_mass_calculated5');
	var elPayload_change = document.querySelector('#Payload_change');
	var elExpand = document.querySelector('#Expand');
	var elsExpanding = document.querySelectorAll('.content tr[class="Expanding"]');
	var els3Stage = document.querySelectorAll('.content tr[class="3Stage"]');
	
	
	window.onload = onPageLoad;
	
	var s_start_point_count = 11;
	var s_start_point_data = [["Canaveral",    			28.5,  -80.33, 0.1],
						      ["Baikonur",              45.57,  63.18, 0.1],
							  ["Kuru",               	 5.14, -52.46, 0.1],
							  ["Alcantara",             -2.28, -44.38, 0.05],
							  ["Camden",                30.92, -81.5,  0],
							  ["Kodiak",            	57.43, 152.33, 0],
							  ["Rocket Lab LC-1",   	39.25, 177.87, 0.1],
							  ["Vandenberg",   			34.72, 120.62, 0.1],
							  ["Omelek Island",      	 9.3,  167.73, 0],
							  ["Stennis Space Center",  30.35, -89.6, 0],
							  ["Sea Launch",  	         0.0, -154.0, 0.02]];

	var s_orbit_count = 7;
	var s_orbit_data = [["LEO",   200,     0, -1, 0],
	                    ["SSO",   500,     0, 98, 0],
						["GEO",   35786,   0,  0, 0],
						["GTO",   200, 35786,  0, 0],
						["Moon",  200,    -1, -1, 3100],
						["Mars",  200,    -1, -1, 3613],
						["Venus", 200,    -1, -1, 3506]];
							  
	var s_fuel_count = 3;
	var s_fuel_name = ["Lox/Kero", "Lox/Methan", "Lox/LH2"];
	var s_fuel_invert = [1,1,1,1,1,1, 0,0,0,0];
	var s_slider = [el1st_Dry_to_Wet_mass_Ratio_Range, el2nd_Dry_to_Wet_mass_Ratio_Range, elTransfer_Orbit_Stage_mass_Ratio_Range, elUnused_propellant_of_1st_Stage_Range,
					elUnused_propellant_of_2nd_Stage_Range, elUnused_propellant_of_Transfer_Orbit_Stage_Range, elFirst_stage_isp_sea_level_or_at_the_start_altitude_Range,
					elFirst_stage_isp_vac_Range, elSecond_stage_isp_vac_Range, elTransfer_Orbit_Stage_isp_Range];
	var s_slider_edit = [el1st_Dry_to_Wet_mass_Ratio, el2nd_Dry_to_Wet_mass_Ratio, elTransfer_Orbit_Stage_mass_Ratio, elUnused_propellant_of_1st_Stage,
					elUnused_propellant_of_2nd_Stage, elUnused_propellant_of_Transfer_Orbit_Stage, elFirst_stage_isp_sea_level_or_at_the_start_altitude,
					elFirst_stage_isp_vac, elSecond_stage_isp_vac, elTransfer_Orbit_Stage_isp];

	var s_fuel_data_min = [[6,  5,  10, 1, 1, 0.5, 260, 300, 320, 320],
						   [7,  6,  10, 1, 1, 0.5, 270, 310, 330, 320],
						   [10, 9,  10, 1, 1, 0.5, 350, 400, 450, 320]];
	var s_fuel_data_max = [[9,  10, 30, 3, 3,   5, 310, 340, 360, 370],
						   [10, 11, 30, 3, 3,   5, 320, 355, 375, 370],
						   [14, 14, 30, 3, 3,   5, 370, 430, 470, 370]];
	
	var s_rocket_count = 16;
	var s_rocket_data = [["Rocket 1",                      1.19,  33400,  150,  3500, 0,  776,   26.94,   0,      8,     10,     20,    1.5, 1.5, 1,   290.5, 327,   365, 320, "Lox/Kero",   "Canaveral",       "LEO", 0, "2stages - aggressive but realistic goal"],
						 ["Rocket 2",                      1.19,  33400,  100,  3500, 0,  440,   26.94,   5,      9.92,  12.38,  20,    2,   2,   1,   282.0, 321,   352, 320, "Lox/Kero",   "Canaveral",       "SSO", 0, "3stages - easily achievable"],
						 ["Rocket 3",                      1.2,   75140,  400,  3500, 0,  1094,  15.49,   3.5,    9.15,  11.65,  20,    2,   2,   1,   282.0, 321,   352, 320, "Lox/Kero",   "Canaveral",       "SSO", 0, "SpaceX style 9 E2 engines at the 1st stage"],
						 ["Zenit-2",                       1.605, 459000, 1800, 3500, 0,  13470, 23.195,  0,      7.93,  9.15,   20,    1.2, 1.2, 0.8, 309.0, 336,   349, 352, "Lox/Kero",   "Baikonur",        "LEO", 0, ""],
						 ["Zenit-3SL",                     1.57,  468240, 1850, 3500, 0,  3170,  24.3196, 4.8825, 7.78,  9.15,   14.42, 1.2, 1.2, 0.8, 309.5, 337.2, 349, 361, "Lox/Kero",   "Sea Launch",      "GEO", 0, ""],
						 ["Delta-IV Medium",               1.21,  264840, 2800, 4500, 0,  11470, 14.51,   0,      11.70, 11.79,  20,    2,   2,   0.8, 360.0, 412,   462, 300, "Lox/LH2",    "Canaveral",       "LEO", 0, ""],
						 ["Falcon9 V1.0",                  1.22,  318000, 1000, 3500, 0,  9000,  19.18,   0.00,   6.74,  5.96,   20.00, 1.5, 1.5, 1,   266.0, 304,   336, 300, "Lox/Kero",   "Canaveral",       "LEO", 0, ""],
						 ["Falcon 1e",                     1.19,  47750,  145,  3500, 0,  650,   11.90,   0.00,   6.13,  11.07,  20.00, 2,   2,   1,   263.0, 304,   317, 300, "Lox/Kero",   "Canaveral",       "LEO", 0, ""],
						 ["Electron",                      1.32,  12550,  44,   3500, 50, 240,   21.39,   0.00,   9.31,  10.42,  20.00, 2,   2,   1,   256.0, 303,   333, 240, "Lox/Kero",   "Rocket Lab LC-1", "LEO", 0, ""],
						 ["Electron Curie",                1.32,  12550,  44,   3500, 50, 150,   21.39,   3.00,   9.31,  10.42,  15.00, 1.5, 1.5, 1,   256.0, 303,   333, 250, "Lox/Kero",   "Rocket Lab LC-1", "SSO", 0, ""],
						 ["Launcher One",                  1.44,  23300,  100,  3500, 0,  300,   12.66,   0.00,   8.00,   9.00,  20.00, 2,   2,   1,   290.0, 308,   328, 300, "Lox/Kero",   "Canaveral",       "SSO", 1, ""],
						 ["Terran 1",                      1.2,   52730,  400,  3500, 0,  1250,  24.46,   0.00,   8.00,   9.00,  20.00, 2,   2,   1,   286.0, 326,   360, 300, "Lox/Methan", "Canaveral",       "LEO", 0, "Relativity"],
						 ["XS-1 tactical missile",         1.6,   7560,   30,   3500, 0,  100,   19.44,   0.00,   9.50,  10.00,  20.00, 2,   2,   1,   266.0, 304,   336, 300, "Lox/Kero",   "Canaveral",       "LEO", 0, "Astra"],
						 ["Firefly Alpha",                 1.25,  54000,  330,  3500, 0,  1000,  25.00,   0.00,   7.50,  6.74,   20.00, 2,   2,   1,   265.0, 295.6, 322, 300, "Lox/Kero",   "Canaveral",       "LEO", 0, ""],
						 ["abl RS1 Old",                   1.2,   26459,  300,  3500, 0,  900,   15.75,   0.00,   5.00,  4.00,   20.00, 2,   2,   1,   262.0, 308,   345, 300, "Lox/Kero",   "Camden",          "LEO", 0, ""],
						 ["abl RS1",                       1.2,   47627,  400,  3500, 0,  1200,  18.06,   0.00,   5.00,  5.00,   20.00, 2,   2,   1,   265.0, 295.6, 322, 300, "Lox/Kero",   "Camden",          "LEO", 0, ""]
						 ];
	
	function Rad2Deg(radians)
	{
		return radians * (180.0/Math.PI);
	}
	
	function Deg2Rad(degrees)
	{
		return degrees * (Math.PI/180.0);
	}
	
	function CalculateTargetMass(Assumed_payload_mass, itteration)
	{
		var Starting_Point_Altitude = parseFloat(elStarting_Point_Altitude.value);
		var Additional_Speed = parseFloat(elAdditional_Speed.value);
		var Orbit_Perigee = parseFloat(elOrbit_Perigee.value);
		var Orbit_Apogee = parseFloat(elOrbit_Apogee.value);
		var Spaceport_latitude = parseFloat(elSpaceport_latitude.value);
		var Orbit_Inclination;
		if (elOrbit.selectedIndex == 1)
		{
			Orbit_Inclination = 95.7+0.00296*Orbit_Perigee+0.000000797*Orbit_Perigee*Orbit_Perigee;
			elOrbit_Inclination.value = Orbit_Inclination.toFixed(2);
		} else
			Orbit_Inclination = parseFloat(elOrbit_Inclination.value);
		
		var Extra_speed_for_flight_to_the_planets = parseFloat(elExtra_speed_for_flight_to_the_planets.value);
		var Intermediate_angle = Orbit_Inclination > Spaceport_latitude ?
				(Rad2Deg(Math.asin(Math.cos(Deg2Rad(Orbit_Inclination))/Math.cos(Deg2Rad(Spaceport_latitude))))) :
				(90.0-Rad2Deg(Math.asin(1.0-(Math.cos(Deg2Rad(Orbit_Inclination))/Math.cos(Deg2Rad(Spaceport_latitude))))));
		elIntermediate_angle.textContent = Intermediate_angle.toFixed(2);
		
		var earth_radius = 6371.0;
		var gravity_const = 398600500000.0;
		
		var Launch_point_speed = 465.0*Math.cos(Deg2Rad(Spaceport_latitude));
		elLaunch_point_speed.textContent = Launch_point_speed.toFixed(2);
		
		var Starting_Point_Altitude_orbital_velosity = Math.sqrt(gravity_const/(earth_radius+Starting_Point_Altitude));
		elStarting_Point_Altitude_orbital_velosity.textContent = Starting_Point_Altitude_orbital_velosity.toFixed(2);
		
		var Absolute_orbital_velocity = Math.sqrt(gravity_const/(earth_radius+Orbit_Perigee));
		elAbsolute_orbital_velocity.textContent = Absolute_orbital_velocity.toFixed(2);
		
		var Orbital_period = (Orbit_Apogee == 0) ?
			2.0*Math.PI/Math.sqrt(398600.5)*Math.pow(6371+Orbit_Perigee, 3.0/2.0)/60.0 :
			2.0*Math.PI/Math.sqrt(398600.5)*Math.pow(6371+0.5*(Orbit_Perigee+Orbit_Apogee), 3.0/2.0)/60.0;
		elOrbital_period.textContent = Orbital_period.toFixed(2);
		
		var tmp_velocity = Math.sqrt(Launch_point_speed*Launch_point_speed + Absolute_orbital_velocity*Absolute_orbital_velocity
										-2.0*Launch_point_speed*Absolute_orbital_velocity*Math.sin(Deg2Rad(Intermediate_angle)));

		var Orbital_velocity = (465.0*Math.cos(Deg2Rad(Orbit_Inclination)) < Absolute_orbital_velocity) ?
								tmp_velocity : -tmp_velocity;
		elOrbital_velocity.textContent = Orbital_velocity.toFixed(2);
		
		var Orbital_velocity_increment_due_to_the_Earth_rotation = Absolute_orbital_velocity - Orbital_velocity;
		elOrbital_velocity_increment_due_to_the_Earth_rotation.textContent = Orbital_velocity_increment_due_to_the_Earth_rotation.toFixed(2);
		
		var Launch_azimuth = Rad2Deg(Math.acos(Absolute_orbital_velocity/Orbital_velocity*Math.cos(Deg2Rad(Intermediate_angle))));
		elLaunch_azimuth.textContent = Launch_azimuth.toFixed(2);
		
		var Specific_velocity_for_circular_orbit = Starting_Point_Altitude_orbital_velosity
				+Starting_Point_Altitude_orbital_velosity*(Starting_Point_Altitude_orbital_velosity/Math.sqrt(0.5*(Starting_Point_Altitude_orbital_velosity*Starting_Point_Altitude_orbital_velosity+Absolute_orbital_velocity*Absolute_orbital_velocity))-1.0)
				+Absolute_orbital_velocity*(1.0-Absolute_orbital_velocity/Math.sqrt(0.5*(Starting_Point_Altitude_orbital_velosity*Starting_Point_Altitude_orbital_velosity+Absolute_orbital_velocity*Absolute_orbital_velocity)))
				-Orbital_velocity_increment_due_to_the_Earth_rotation;
		elSpecific_velocity_for_circular_orbit.textContent = Specific_velocity_for_circular_orbit.toFixed(2);
		
		var Specific_velocity_for_target_orbit = (Orbit_Apogee == 0) ?
			Specific_velocity_for_circular_orbit + Extra_speed_for_flight_to_the_planets : 
			(Specific_velocity_for_circular_orbit + Extra_speed_for_flight_to_the_planets
			  +Absolute_orbital_velocity*(Absolute_orbital_velocity/Math.sqrt(0.5*(Absolute_orbital_velocity*Absolute_orbital_velocity+gravity_const/(earth_radius+Orbit_Apogee)))-1.0));
		elSpecific_velocity_for_target_orbit.textContent = Specific_velocity_for_target_orbit.toFixed(2);
		
		var Specific_velocity_for_LEO = 8023.0-Orbital_velocity_increment_due_to_the_Earth_rotation-Additional_Speed;
		elSpecific_velocity_for_LEO.textContent = Specific_velocity_for_LEO.toFixed(2);
		
		var Specific_Impulse_Variation = parseFloat(elSpecific_Impulse_Variation.value);
		var Fairing_jettison_velocity = parseFloat(elFairing_jettison_velocity.value);
		var Fairing_mass = parseFloat(elFairing_mass.value);
		var Lift_off_Mass = parseFloat(elLift_off_Mass.value);
		var Thrust_to_weight_ratio = parseFloat(elThrust_to_weight_ratio.value);
		var First_stage_isp_vac = parseFloat(elFirst_stage_isp_vac.value) * Specific_Impulse_Variation / 100.0;
		var First_stage_isp_sea_level_or_at_the_start_altitude = parseFloat(elFirst_stage_isp_sea_level_or_at_the_start_altitude.value) * Specific_Impulse_Variation / 100.0;
		var v2nd_Stage_mass_Ratio = parseFloat(el2nd_Stage_mass_Ratio.value);
		var v3rd_Stage_mass_Ratio = parseFloat(el3rd_Stage_mass_Ratio.value);
		var v1st_Dry_to_Wet_mass_Ratio = parseFloat(el1st_Dry_to_Wet_mass_Ratio.value);
		var v2nd_Dry_to_Wet_mass_Ratio = parseFloat(el2nd_Dry_to_Wet_mass_Ratio.value);
		var Unused_propellant_of_1st_Stage = parseFloat(elUnused_propellant_of_1st_Stage.value);
		var Unused_propellant_of_2nd_Stage = parseFloat(elUnused_propellant_of_2nd_Stage.value);
		var Second_stage_isp_vac = parseFloat(elSecond_stage_isp_vac.value) * Specific_Impulse_Variation / 100.0;
		var Transfer_Orbit_Stage_isp = parseFloat(elTransfer_Orbit_Stage_isp.value) * Specific_Impulse_Variation / 100.0;
		var Transfer_Orbit_Stage_mass_Ratio = parseFloat(elTransfer_Orbit_Stage_mass_Ratio.value);
		var Unused_propellant_of_Transfer_Orbit_Stage = parseFloat(elUnused_propellant_of_Transfer_Orbit_Stage.value);
		var Jettisoned_battery_mass = parseFloat(elJettisoned_battery_mass.value);
		
		var Payload_to_Lift_off_mass_Ratio = Assumed_payload_mass / Lift_off_Mass;
		elPayload_to_Lift_off_mass_Ratio.textContent = (Payload_to_Lift_off_mass_Ratio * 100.0).toFixed(2);
	
		var Gravity_losses_at_specific_altitude = 9.81*(500.0/Math.sqrt((1.015*Math.sqrt((((Thrust_to_weight_ratio-1.0)*9.81)*
				((Math.exp(112.13/((First_stage_isp_vac-(First_stage_isp_vac-First_stage_isp_sea_level_or_at_the_start_altitude)*0.169)+
				(((First_stage_isp_vac-(First_stage_isp_vac-First_stage_isp_sea_level_or_at_the_start_altitude)*0.169)-First_stage_isp_sea_level_or_at_the_start_altitude)*1)/((1-0.169)*1.8872)*(-0.8612))))*
				((First_stage_isp_vac-(First_stage_isp_vac-First_stage_isp_sea_level_or_at_the_start_altitude)*0.169)/First_stage_isp_sea_level_or_at_the_start_altitude)*
				((Thrust_to_weight_ratio-1)*9.81)-(1-(Math.exp(112.13/((First_stage_isp_vac-(First_stage_isp_vac-First_stage_isp_sea_level_or_at_the_start_altitude)*0.169)+
				(((First_stage_isp_vac-(First_stage_isp_vac-First_stage_isp_sea_level_or_at_the_start_altitude)*0.169)-First_stage_isp_sea_level_or_at_the_start_altitude)*1)/((1-0.169)*1.8872)*(-0.8612))))*
				((First_stage_isp_vac-(First_stage_isp_vac-First_stage_isp_sea_level_or_at_the_start_altitude)*0.169)/First_stage_isp_sea_level_or_at_the_start_altitude))*9.81))))*9.81));
				elPayload_to_Lift_off_mass_Ratio.textContent = (Payload_to_Lift_off_mass_Ratio * 100.0).toFixed(2);
		elGravity_losses_at_specific_altitude.textContent = Gravity_losses_at_specific_altitude.toFixed(2);
		
		var Gravity_losses	= 0.94*Specific_velocity_for_LEO/8026*4/3*
		((Thrust_to_weight_ratio<1.46)
				? Gravity_losses_at_specific_altitude*(1.5+2.5*(Thrust_to_weight_ratio-1.17)-4.25*(Thrust_to_weight_ratio-1.17)*(Thrust_to_weight_ratio-1.17))
				: 1.865*Gravity_losses_at_specific_altitude);
		elGravity_losses.textContent = Gravity_losses.toFixed(2);
		
		var Aerodynamic_losses = Math.exp(-Starting_Point_Altitude/7.16)*0.94*Specific_velocity_for_LEO/8026*Math.pow(Math.pow(Lift_off_Mass/2945000, 0.33333333), -0.9) * (0.045+0.1*Math.pow(Thrust_to_weight_ratio-1.17, 1.5))*1000;
		elAerodynamic_losses.textContent = Aerodynamic_losses.toFixed(2);
		
		var Summary_losses = Gravity_losses+Aerodynamic_losses+Specific_velocity_for_LEO/8026*140;
		elSummary_losses.textContent = Summary_losses.toFixed(2);
		
		var Assumed_losses = Summary_losses/Specific_velocity_for_LEO;
		elAssumed_losses.textContent = (Assumed_losses*100.0).toFixed(2);
		
		var Specific_velocity_with_losses = Specific_velocity_for_target_orbit+Summary_losses;
		elSpecific_velocity_with_losses.textContent = Specific_velocity_with_losses.toFixed(2);
		
		
		//=== Output ===
		var First_stage_average_trajectory_isp = 0.145*First_stage_isp_sea_level_or_at_the_start_altitude+0.855*First_stage_isp_vac;
		elFirst_stage_average_trajectory_isp.textContent = First_stage_average_trajectory_isp.toFixed(2);
		
		var First_stage_propellant_mass = (Lift_off_Mass*(1-v2nd_Stage_mass_Ratio/100))*(1-v1st_Dry_to_Wet_mass_Ratio/100);
		elFirst_stage_propellant_mass.textContent = First_stage_propellant_mass.toFixed(2);
		
		var First_stage_dry_mass = (Lift_off_Mass*(1-v2nd_Stage_mass_Ratio/100))*(v1st_Dry_to_Wet_mass_Ratio/100);
		elFirst_stage_dry_mass.textContent = First_stage_dry_mass.toFixed(2);
		
		var First_stage_final_mass = Lift_off_Mass-First_stage_propellant_mass/100*(100-Unused_propellant_of_1st_Stage);
		elFirst_stage_final_mass.textContent = First_stage_final_mass.toFixed(2);
		
		var First_stage_specific_velocity = 9.80665*First_stage_average_trajectory_isp*Math.log(Lift_off_Mass/First_stage_final_mass);
		elFirst_stage_specific_velocity.textContent = First_stage_specific_velocity.toFixed(2);
		

		var Fairing_jettison_specific_velocity = (Fairing_jettison_velocity*1.2 > First_stage_specific_velocity) ? Fairing_jettison_velocity*1.2 : First_stage_specific_velocity+100;
		elFairing_jettison_specific_velocity.textContent = Fairing_jettison_specific_velocity.toFixed(2);
		
		var Second_stage_total_Start_mass = Lift_off_Mass*(v2nd_Stage_mass_Ratio/100);
		elSecond_stage_total_Start_mass.textContent = Second_stage_total_Start_mass.toFixed(2);

		var Second_stage_total_mass_before_fairing_jettison =1.0/(Math.exp((Fairing_jettison_specific_velocity-First_stage_specific_velocity)/(Second_stage_isp_vac*9.80665))/Second_stage_total_Start_mass);
		elSecond_stage_total_mass_before_fairing_jettison.textContent = Second_stage_total_mass_before_fairing_jettison.toFixed(2);

		
		
		var Second_stage_final_mass;
		var Second_stage_specific_velocity;
		var Second_stage_dry_mass;
		var Second_stage_propellant_mass;
		var Second_stage_total_mass_before_battery_jettison;
		if (v3rd_Stage_mass_Ratio == 0)
		{
			Second_stage_specific_velocity = Specific_velocity_with_losses-First_stage_specific_velocity;

			Second_stage_dry_mass = (Second_stage_total_Start_mass-Fairing_mass-Assumed_payload_mass)*v2nd_Dry_to_Wet_mass_Ratio/100;
			Second_stage_propellant_mass = Second_stage_dry_mass*(100/v2nd_Dry_to_Wet_mass_Ratio)-Second_stage_dry_mass;
			
			Second_stage_total_mass_before_battery_jettison = Second_stage_dry_mass+0.67*Second_stage_propellant_mass;
			
			Second_stage_specific_velocity_before_battery_jettison = 9.80665*Second_stage_isp_vac*
				Math.log((Second_stage_total_mass_before_fairing_jettison-Fairing_mass)/Second_stage_total_mass_before_battery_jettison);

			Second_stage_final_mass = 1.0/(Math.exp(
				(Second_stage_specific_velocity-(Fairing_jettison_specific_velocity-First_stage_specific_velocity)
				-Second_stage_specific_velocity_before_battery_jettison)
				/(Second_stage_isp_vac*9.80665))/(Second_stage_total_mass_before_battery_jettison
					-Jettisoned_battery_mass));
		} else
		{
			Second_stage_final_mass = Second_stage_total_Start_mass 
					-((Lift_off_Mass*(v2nd_Stage_mass_Ratio-v3rd_Stage_mass_Ratio)/100)*(1-v2nd_Dry_to_Wet_mass_Ratio/100))/100*
					 (100-Unused_propellant_of_2nd_Stage)-Jettisoned_battery_mass;
			
			Second_stage_dry_mass = (Second_stage_total_Start_mass-Second_stage_final_mass)*(1+Unused_propellant_of_2nd_Stage/100)/(1/(v2nd_Dry_to_Wet_mass_Ratio/100)-1)-Fairing_mass*v2nd_Dry_to_Wet_mass_Ratio/100;
			Second_stage_propellant_mass = Second_stage_dry_mass*(100/v2nd_Dry_to_Wet_mass_Ratio)-Second_stage_dry_mass;

			Second_stage_total_mass_before_battery_jettison = Second_stage_dry_mass+0.67*Second_stage_propellant_mass;
			
			Second_stage_specific_velocity = 9.80665*Second_stage_isp_vac*Math.log(Second_stage_total_Start_mass/Second_stage_total_mass_before_fairing_jettison)
				+9.80665*Second_stage_isp_vac*Math.log((Second_stage_total_mass_before_fairing_jettison-Fairing_mass)/Second_stage_total_mass_before_battery_jettison)
				+9.80665*Second_stage_isp_vac*Math.log((Second_stage_total_mass_before_battery_jettison-Jettisoned_battery_mass)/Second_stage_final_mass);

			Second_stage_specific_velocity_before_battery_jettison = 9.80665*Second_stage_isp_vac*
				Math.log((Second_stage_total_mass_before_fairing_jettison-Fairing_mass)/Second_stage_total_mass_before_battery_jettison);;
		}
		elSecond_stage_total_mass_before_battery_jettison.textContent = Second_stage_total_mass_before_battery_jettison.toFixed(2);
		elSecond_stage_specific_velocity_before_battery_jettison.textContent = Second_stage_specific_velocity_before_battery_jettison.toFixed(2);

		elSecond_stage_final_mass.textContent = Second_stage_final_mass.toFixed(2);
		elSecond_stage_specific_velocity.textContent = Second_stage_specific_velocity.toFixed(2);
		
		elSecond_stage_dry_mass.textContent = Second_stage_dry_mass.toFixed(2);
		
		var Second_stage_propellant_mass = Second_stage_dry_mass*(100.0/v2nd_Dry_to_Wet_mass_Ratio)-Second_stage_dry_mass;
		elSecond_stage_propellant_mass.textContent = Second_stage_propellant_mass.toFixed(2);
		
		var Transfer_Orbit_stage_specific_velocity_required = v3rd_Stage_mass_Ratio == 0 ? 0 :
			(Specific_velocity_with_losses-First_stage_specific_velocity-Second_stage_specific_velocity);
		elTransfer_Orbit_stage_specific_velocity_required.textContent = Transfer_Orbit_stage_specific_velocity_required.toFixed(2);
		
		var Transfer_Orbit_stage_total_Start_mass = Second_stage_final_mass+Jettisoned_battery_mass-Second_stage_dry_mass-Second_stage_propellant_mass/100*Unused_propellant_of_2nd_Stage;
		elTransfer_Orbit_stage_total_Start_mass.textContent = Transfer_Orbit_stage_total_Start_mass.toFixed(2);
		
		var Transfer_Orbit_stage_final_mass = 1.0/(Math.exp(Transfer_Orbit_stage_specific_velocity_required/(Transfer_Orbit_Stage_isp*9.80665))/Transfer_Orbit_stage_total_Start_mass);
		elTransfer_Orbit_stage_final_mass.textContent = Transfer_Orbit_stage_final_mass.toFixed(2);

		var Transfer_Orbit_stage_dry_mass = v3rd_Stage_mass_Ratio == 0 ? 0 : ((Lift_off_Mass*v3rd_Stage_mass_Ratio/100-Assumed_payload_mass)*Transfer_Orbit_Stage_mass_Ratio/100);
		elTransfer_Orbit_stage_dry_mass.textContent = Transfer_Orbit_stage_dry_mass.toFixed(2);
		
		var Transfer_Orbit_stage_propellant_mass = Transfer_Orbit_stage_dry_mass*(100/Transfer_Orbit_Stage_mass_Ratio)-Transfer_Orbit_stage_dry_mass ;
		elTransfer_Orbit_stage_propellant_mass.textContent = Transfer_Orbit_stage_propellant_mass.toFixed(2);
		
		//=== Result ===
		var Payload_mass_calculated = v3rd_Stage_mass_Ratio == 0 ? Transfer_Orbit_stage_total_Start_mass :
			(Transfer_Orbit_stage_final_mass-Transfer_Orbit_stage_dry_mass-Transfer_Orbit_stage_propellant_mass/100*Unused_propellant_of_Transfer_Orbit_Stage);
		if (itteration == 1)
		{
			elPayload_mass_calculated.textContent = Payload_mass_calculated.toFixed(2);
		} else if (itteration == 5)
		{
			var Assumed_payload_mass_base = parseFloat(elAssumed_payload_mass.value);
			elPayload_mass_calculated5.textContent = Payload_mass_calculated.toFixed(2);
			var Payload_change = Payload_mass_calculated/Assumed_payload_mass_base;
			elPayload_change.textContent = (Payload_change * 100.0).toFixed(2);	
		}
		return Payload_mass_calculated;		
	}

	function Calculate()
	{
		if (parseFloat(el3rd_Stage_mass_Ratio.value) == 0)
		{
			elStages.textContent = "2";
			for (var i = 0; i < els3Stage.length; i++)
				els3Stage[i].setAttribute("hidden", "true");
		} else
		{
			elStages.textContent = "3";
			for (var i = 0; i < els3Stage.length; i++)
				els3Stage[i].removeAttribute("hidden");
		}

		var Assumed_payload_mass = parseFloat(elAssumed_payload_mass.value);
		for (itt = 1; itt <= 5; ++itt)
		{
			Assumed_payload_mass = CalculateTargetMass(Assumed_payload_mass, itt);
		}
	}
	
	function updateStartingPoint()
	{
		elStarting_Point_Altitude.value = s_start_point_data[elStartingPoint.selectedIndex][3];
		elSpaceport_latitude.value = s_start_point_data[elStartingPoint.selectedIndex][1];
	}
	
	function updateStartingPointAndCalc()
	{
		updateStartingPoint();
		Calculate();
	}

	function updateOrbit()
	{
		elOrbit_Perigee.value = s_orbit_data[elOrbit.selectedIndex][1];
		
		if (s_orbit_data[elOrbit.selectedIndex][2] < 0)
			elOrbit_Apogee.value = elSpaceport_latitude.value;
		else
			elOrbit_Apogee.value = s_orbit_data[elOrbit.selectedIndex][2];
			
		if (s_orbit_data[elOrbit.selectedIndex][3] < 0)
			elOrbit_Inclination.value = elSpaceport_latitude.value;	
		else
			elOrbit_Inclination.value = s_orbit_data[elOrbit.selectedIndex][3];
			
		elExtra_speed_for_flight_to_the_planets.value = s_orbit_data[elOrbit.selectedIndex][4];
	}
	
	function RangeMinMax(range, input_field, fuel, index)
	{
		var val_min = s_fuel_data_min[fuel][index];
		var val_max = s_fuel_data_max[fuel][index];

		var input_value = parseFloat(input_field.value);
		//if (input_value < val_min)
		//	input_field.value = val_min;
		//if (input_value > val_max)
		//	input_field.value = val_max;

		if ("min" in range)
			range.min = val_min * 100;
		else
            range.setAttribute("min", val_min * 100);
			
		if ("max" in range)
			range.max = val_max * 100;
		else
            range.setAttribute("max", val_max * 100);
		if (s_fuel_invert[index])
			range.value = (val_min + val_max - input_value) * 100;
		else
			range.value = input_value * 100;
	}
	
	
	function updateFuel()
	{
		var fuel = elFuel.selectedIndex;
		for (var i = 0; i < 10; ++i)
			RangeMinMax(s_slider[i], s_slider_edit[i], fuel, i);
	}
	
	function updateSlider(index)
	{
		if (s_fuel_invert[index])
		{
			var vmin;
			var vmax;
			if ("min" in s_slider[index])
				vmin = parseFloat(s_slider[index].min);
			else
				vmin = s_slider[index].getAttribute("min");
			
			if ("max" in s_slider[index])
				vmax = parseFloat(s_slider[index].max);
			else
				vmax = s_slider[index].getAttribute("max");
			s_slider_edit[index].value = (vmin + vmax - s_slider[index].value) / 100;
		} else
			s_slider_edit[index].value = s_slider[index].value / 100.0;
		Calculate();
	}
	
	function updateSliderEdit(index)
	{
		var val_min;
		var val_max;
		if (s_fuel_invert[index])
		{
			if ("min" in s_slider[index])
				val_min = parseFloat(s_slider[index].min);
			else
				val_min = s_slider[index].getAttribute("min");
			
			if ("max" in s_slider[index])
				val_max = parseFloat(s_slider[index].max);
			else
				val_max = s_slider[index].getAttribute("max");
			s_slider[index].value = val_min + val_max - s_slider_edit[index].value * 100.0;
		} else
			s_slider[index].value = s_slider[index].s_slider_edit * 100.0;
		Calculate();
	}
	
	function update1st_Dry_to_Wet_mass_Ratio_Range()
	{
		updateSlider(0);
	}

	function update2nd_Dry_to_Wet_mass_Ratio_Range()
	{
		updateSlider(1);
	}
	
	function updateTransfer_Orbit_Stage_mass_Ratio_Range()
	{
		updateSlider(2);
	}
	
	function updateUnused_propellant_of_1st_Stage_Range()
	{
		updateSlider(3);
	}
	
	function updateUnused_propellant_of_2nd_Stage_Range()
	{
		updateSlider(4);
	}
	
	function updateUnused_propellant_of_Transfer_Orbit_Stage_Range()
	{
		updateSlider(5);
	}
	
	function updateFirst_stage_isp_sea_level_or_at_the_start_altitude_Range()
	{
		updateSlider(6);
	}
	
	function updateFirst_stage_isp_vac_Range()
	{
		updateSlider(7);
	}
	
	function updateSecond_stage_isp_vac_Range()
	{
		updateSlider(8);
	}
	
	function updateTransfer_Orbit_Stage_isp_Range()
	{
		updateSlider(9);
	}

	
	function update1st_Dry_to_Wet_mass_Ratio()
	{
		updateSliderEdit(0);
	}

	function update2nd_Dry_to_Wet_mass_Ratio()
	{
		updateSliderEdit(1);
	}
	
	function updateTransfer_Orbit_Stage_mass_Ratio()
	{
		updateSliderEdit(2);
	}
	
	function updateUnused_propellant_of_1st_Stage()
	{
		updateSliderEdit(3);
	}
	
	function updateUnused_propellant_of_2nd_Stage()
	{
		updateSliderEdit(4);
	}
	
	function updateUnused_propellant_of_Transfer_Orbit_Stage()
	{
		updateSliderEdit(5);
	}
	
	function updateFirst_stage_isp_sea_level_or_at_the_start_altitude()
	{
		updateSliderEdit(6);
	}
	
	function updateFirst_stage_isp_vac()
	{
		updateSliderEdit(7);
	}
	
	function updateSecond_stage_isp_vac()
	{
		updateSliderEdit(8);
	}
	
	function updateTransfer_Orbit_Stage_isp()
	{
		updateSliderEdit(9);
	}
					
	function updateOrbitAndCalc()
	{
		updateOrbit();
		Calculate();
		updateFuel();
	}
	
	function updateRocket()
	{
		elThrust_to_weight_ratio.value = s_rocket_data[elRocket.selectedIndex][1];
		elLift_off_Mass.value = s_rocket_data[elRocket.selectedIndex][2];
		elFairing_mass.value = s_rocket_data[elRocket.selectedIndex][3];
		elFairing_jettison_velocity.value = s_rocket_data[elRocket.selectedIndex][4];
		elJettisoned_battery_mass.value = s_rocket_data[elRocket.selectedIndex][5];
		elAssumed_payload_mass.value = s_rocket_data[elRocket.selectedIndex][6];
		el2nd_Stage_mass_Ratio.value = s_rocket_data[elRocket.selectedIndex][7];
		el3rd_Stage_mass_Ratio.value = s_rocket_data[elRocket.selectedIndex][8];
		
		el1st_Dry_to_Wet_mass_Ratio.value = s_rocket_data[elRocket.selectedIndex][9];
		el2nd_Dry_to_Wet_mass_Ratio.value = s_rocket_data[elRocket.selectedIndex][10];
		elTransfer_Orbit_Stage_mass_Ratio.value = s_rocket_data[elRocket.selectedIndex][11];
		elUnused_propellant_of_1st_Stage.value = s_rocket_data[elRocket.selectedIndex][12];
		elUnused_propellant_of_2nd_Stage.value = s_rocket_data[elRocket.selectedIndex][13];
		elUnused_propellant_of_Transfer_Orbit_Stage.value = s_rocket_data[elRocket.selectedIndex][14];
		elFirst_stage_isp_sea_level_or_at_the_start_altitude.value = s_rocket_data[elRocket.selectedIndex][15];
		elFirst_stage_isp_vac.value = s_rocket_data[elRocket.selectedIndex][16];
		elSecond_stage_isp_vac.value = s_rocket_data[elRocket.selectedIndex][17];
		elTransfer_Orbit_Stage_isp.value = s_rocket_data[elRocket.selectedIndex][18];
		
		var spacePort = s_rocket_data[elRocket.selectedIndex][20];
		for (var i=0; i < s_start_point_count; ++i)
		{
			if ( s_start_point_data[i][0] == spacePort )
			{
				elStartingPoint.selectedIndex = i;
				updateStartingPoint();
				break;
			}
		}
		
		var orbit = s_rocket_data[elRocket.selectedIndex][21];
		for (var i=0; i < s_orbit_count; ++i)
		{
			if ( s_orbit_data[i][0] == orbit )
			{
				elOrbit.selectedIndex = i;
				updateOrbit();
				break;
			}
		}
		
		var fuel = s_rocket_data[elRocket.selectedIndex][19];
		for (var i=0; i < s_fuel_count; ++i)
		{
			if ( s_fuel_name[i] == fuel )
			{
				elFuel.selectedIndex = i;
				updateFuel();
				break;
			}
		}
		
		elAir_Launch.checked = s_rocket_data[elRocket.selectedIndex][22] != 0;
		AirLaunchChange();
		
		elRocketDescription.textContent = s_rocket_data[elRocket.selectedIndex][23];
	}
	
	function updateRocketAndCalc()
	{
		updateRocket();
		Calculate();
	}
	
	function ExpandChange()
	{
		if (elExpand.checked)
		{
			for (var i = 0; i < elsExpanding.length; i++)
				elsExpanding[i].removeAttribute("hidden");
		} else
		{
			for (var i = 0; i < elsExpanding.length; i++)
				elsExpanding[i].setAttribute("hidden","true");
		}
	}
	
	function AirLaunchChange()
	{
		if (elAir_Launch.checked)
		{
			elStarting_Point_Altitude.value = 12;
			elAdditional_Speed.value = 250;
		} else
		{
			elStarting_Point_Altitude.value = s_start_point_data[elStartingPoint.selectedIndex][3];
			elAdditional_Speed.value = 0;
		}
	}
	
	function AirLaunchChangeAndCalc()
	{
		AirLaunchChange();
		Calculate();
	}
	
	function onPageLoad()
	{
		for (var i = 0; i<s_start_point_count; i++)
		{
			var opt = document.createElement('option');
			opt.value = s_start_point_data[i][0];
			opt.innerHTML = s_start_point_data[i][0];
			elStartingPoint.appendChild(opt);
		}
		elStartingPoint.addEventListener('change', updateStartingPointAndCalc);
		
		for (var i = 0; i<s_rocket_count; i++)
		{
			var opt = document.createElement('option');
			opt.value = s_rocket_data[i][0];
			opt.innerHTML = s_rocket_data[i][0];
			elRocket.appendChild(opt);
		}
		elRocket.addEventListener('change', updateRocketAndCalc);
		
		for (var i = 0; i<s_orbit_count; i++)
		{
			var opt = document.createElement('option');
			opt.value = s_orbit_data[i][0];
			opt.innerHTML = s_orbit_data[i][0];
			elOrbit.appendChild(opt);
		}
		elOrbit.addEventListener('change', updateOrbitAndCalc);
		
		for (var i = 0; i<s_fuel_count; i++)
		{
			var opt = document.createElement('option');
			opt.value = s_fuel_name[i];
			opt.innerHTML = s_fuel_name[i];
			elFuel.appendChild(opt);
		}
		elFuel.addEventListener('change', updateFuel);

		el1st_Dry_to_Wet_mass_Ratio_Range.addEventListener('change', update1st_Dry_to_Wet_mass_Ratio_Range);
		el2nd_Dry_to_Wet_mass_Ratio_Range.addEventListener('change', update2nd_Dry_to_Wet_mass_Ratio_Range);
		elTransfer_Orbit_Stage_mass_Ratio_Range.addEventListener('change', updateTransfer_Orbit_Stage_mass_Ratio_Range);
		elUnused_propellant_of_1st_Stage_Range.addEventListener('change', updateUnused_propellant_of_1st_Stage_Range);
		elUnused_propellant_of_2nd_Stage_Range.addEventListener('change', updateUnused_propellant_of_2nd_Stage_Range);
		elUnused_propellant_of_Transfer_Orbit_Stage_Range.addEventListener('change', updateUnused_propellant_of_Transfer_Orbit_Stage_Range);
		elFirst_stage_isp_sea_level_or_at_the_start_altitude_Range.addEventListener('change', updateFirst_stage_isp_sea_level_or_at_the_start_altitude_Range);
		elFirst_stage_isp_vac_Range.addEventListener('change', updateFirst_stage_isp_vac_Range);
		elSecond_stage_isp_vac_Range.addEventListener('change', updateSecond_stage_isp_vac_Range);
		elTransfer_Orbit_Stage_isp_Range.addEventListener('change', updateTransfer_Orbit_Stage_isp_Range);
		
		el1st_Dry_to_Wet_mass_Ratio.addEventListener('change', update1st_Dry_to_Wet_mass_Ratio);
		el2nd_Dry_to_Wet_mass_Ratio.addEventListener('change', update2nd_Dry_to_Wet_mass_Ratio);
		elTransfer_Orbit_Stage_mass_Ratio.addEventListener('change', updateTransfer_Orbit_Stage_mass_Ratio);
		elUnused_propellant_of_1st_Stage.addEventListener('change', updateUnused_propellant_of_1st_Stage);
		elUnused_propellant_of_2nd_Stage.addEventListener('change', updateUnused_propellant_of_2nd_Stage);
		elUnused_propellant_of_Transfer_Orbit_Stage.addEventListener('change', updateUnused_propellant_of_Transfer_Orbit_Stage);
		elFirst_stage_isp_sea_level_or_at_the_start_altitude.addEventListener('change', updateFirst_stage_isp_sea_level_or_at_the_start_altitude);
		elFirst_stage_isp_vac.addEventListener('change', updateFirst_stage_isp_vac);
		elSecond_stage_isp_vac.addEventListener('change', updateSecond_stage_isp_vac);
		elTransfer_Orbit_Stage_isp.addEventListener('change', updateTransfer_Orbit_Stage_isp);

		elStarting_Point_Altitude.addEventListener('change', Calculate);
		elAdditional_Speed.addEventListener('change', Calculate);
		elOrbit_Perigee.addEventListener('change', Calculate);
		elOrbit_Apogee.addEventListener('change', Calculate);
		elSpaceport_latitude.addEventListener('change', Calculate);
		elOrbit_Inclination.addEventListener('change', Calculate);
		
		elThrust_to_weight_ratio.addEventListener('change', Calculate);
		elLift_off_Mass.addEventListener('change', Calculate);
		elFairing_mass.addEventListener('change', Calculate);
		elFairing_jettison_velocity.addEventListener('change', Calculate);
		elJettisoned_battery_mass.addEventListener('change', Calculate);
		elAssumed_payload_mass.addEventListener('change', Calculate);
		el2nd_Stage_mass_Ratio.addEventListener('change', Calculate);
		el3rd_Stage_mass_Ratio.addEventListener('change', Calculate);
		
		el2nd_Dry_to_Wet_mass_Ratio.addEventListener('change', Calculate);
		elTransfer_Orbit_Stage_mass_Ratio.addEventListener('change', Calculate);
		elUnused_propellant_of_1st_Stage.addEventListener('change', Calculate);
		elUnused_propellant_of_2nd_Stage.addEventListener('change', Calculate);
		elUnused_propellant_of_Transfer_Orbit_Stage.addEventListener('change', Calculate);
		elFirst_stage_isp_sea_level_or_at_the_start_altitude.addEventListener('change', Calculate);
		elFirst_stage_isp_vac.addEventListener('change', Calculate);
		elSecond_stage_isp_vac.addEventListener('change', Calculate);
		elTransfer_Orbit_Stage_isp.addEventListener('change', Calculate);
		elExtra_speed_for_flight_to_the_planets.addEventListener('change', Calculate);
		elSpecific_Impulse_Variation.addEventListener('change', Calculate);
		
		elExpand.checked = false;
		elExpand.addEventListener('change', ExpandChange);
		ExpandChange();
		
		elAir_Launch.checked = false;
		elAir_Launch.addEventListener('change', AirLaunchChangeAndCalc);
		
		updateRocket();
		updateStartingPoint();
		updateOrbit();
		updateFuel();
		Calculate();
	}

</script>

</body>
</html>